<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Booking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
    <style>
        :root {
            --primary-color: #0d6efd;
            --border-color: #dee2e6;
        }

        body {
            background-color: #f8f9fa;
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }

        #map {
            height: 600px;
            width: 100%;
            border-radius: 0.375rem;
        }

        .train-card {
            transition: transform 0.2s;
        }

        .train-card:hover {
            transform: translateY(-2px);
        }

        .price-badge {
            font-size: 1.25rem;
            color: #198754;
            font-weight: bold;
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .custom-notification {
            background-color: #232531;
            color: white;
            width: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            display: none;
        }

        .history-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .status-active { background-color: #198754; }
        .status-delayed { background-color: #ffc107; }
        .status-inactive { background-color: #dc3545; }

        .passenger-control {
            width: 120px;
        }

        .passenger-control .btn {
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">MRT Booking System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#statusModal">Status</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#historyModal">History</a>
                    </li>
                </ul>
                <div class="ms-auto">
                    <a href="#" class="text-decoration-none text-muted" data-bs-toggle="modal" data-bs-target="#loginModal">
                        <span id="userDisplay">Sign In</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Left Side - Ticket Booking -->
            <div class="col-lg-5">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Book Your Ticket</h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">From Station:</label>
                                <select class="form-select" id="fromStation" onchange="updatePrice()">
                                    <option value="">Select Station</option>
                                    <optgroup label="MRT-3 Line">
                                        <option value="North Avenue">North Avenue</option>
                                        <option value="Quezon Avenue">Quezon Avenue</option>
                                        <option value="Kamuning">Kamuning</option>
                                        <option value="Cubao">Cubao</option>
                                        <option value="Santolan">Santolan</option>
                                        <option value="Ortigas">Ortigas</option>
                                        <option value="Shaw">Shaw Boulevard</option>
                                        <option value="Boni">Boni</option>
                                        <option value="Guadalupe">Guadalupe</option>
                                        <option value="Buendia">Buendia</option>
                                        <option value="Ayala">Ayala</option>
                                        <option value="Magallanes">Magallanes</option>
                                        <option value="Taft">Taft Avenue</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">To Station:</label>
                                <select class="form-select" id="toStation" onchange="updatePrice()">
                                    <!-- Same options as fromStation -->
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Discount Type:</label>
                                <select class="form-select" id="discountType" onchange="updatePrice()">
                                    <option value="regular">Regular</option>
                                    <option value="pwd">PWD (30% off)</option>
                                    <option value="elderly">Elderly (30% off)</option>
                                    <option value="student">Student (20% off)</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Travel Date:</label>
                                <input type="date" class="form-control" id="travelDate">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Number of Passengers:</label>
                                <div class="input-group passenger-control">
                                    <button class="btn btn-outline-secondary" onclick="adjustPassengers(-1)">-</button>
                                    <span class="form-control text-center" id="passengerCount">1</span>
                                    <button class="btn btn-outline-secondary" onclick="adjustPassengers(1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Train Options -->
                <div class="train-list">
                    <!-- Train cards will be dynamically populated -->
                </div>
            </div>

            <!-- Right Side - Map -->
            <div class="col-lg-7">
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sign In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="alert alert-danger d-none" id="loginError"></div>
                        <button type="submit" class="btn btn-primary w-100">Sign In</button>
                    </form>
                    <div class="mt-3 text-center">
                        <a href="#" onclick="showRegisterForm()">Don't have an account? Register</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal fade" id="statusModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Train Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">MRT-3 Line</h6>
                                    <small class="text-muted">Updated 5 minutes ago</small>
                                </div>
                                <span class="status-indicator status-active"></span>
                            </div>
                            <p class="mb-1">Operating normally</p>
                        </div>
                        <!-- Add more status items as needed -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal fade" id="historyModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Booking History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="history-container" id="ticketHistory"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // Global variables
    var currentUser = null;
    var ticketHistory = [];
    
    // Station coordinates
    var stations = {
        'North Avenue': [14.6527, 121.0317],
        'Quezon Avenue': [14.6426, 121.0355],
        'Kamuning': [14.6329, 121.0366],
        'Cubao': [14.6191, 121.0509],
        'Santolan': [14.6086, 121.0557],
        'Ortigas': [14.5883, 121.0566],
        'Shaw': [14.5810, 121.0533],
        'Boni': [14.5747, 121.0474],
        'Guadalupe': [14.5671, 121.0430],
        'Buendia': [14.5539, 121.0334],
        'Ayala': [14.5499, 121.0278],
        'Magallanes': [14.5419, 121.0194],
        'Taft': [14.5378, 121.0145]
    };

    // Discount rates
    var discountRates = {
        regular: 0,
        pwd: 0.30,    // 30% discount
        elderly: 0.30, // 30% discount
        student: 0.20  // 20% discount
    };

    // Base prices per station distance
    var basePrice = 15; // Base fare
    var pricePerStation = 2; // Additional fare per station
    // Initialize map when page loads
    window.onload = function() {
        initMap();
        initStations();
        updatePrice();
    };

    function initMap() {
        // Initialize the map centered on Metro Manila
        var map = L.map('map').setView([14.5995, 121.0367], 12);
        
        // Add the OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Create a custom icon for stations
        var stationIcon = L.divIcon({
            html: '<div style="background-color: #0d6efd; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;"></div>',
            className: 'station-marker',
            iconSize: [12, 12]
        });

        // Add markers for each station
        Object.entries(stations).forEach(([name, coords]) => {
            L.marker(coords, {icon: stationIcon})
                .bindPopup(name)
                .addTo(map);
        });

        // Draw the train line
        var stationPoints = Object.values(stations);
        L.polyline(stationPoints, {
            color: '#0d6efd',
            weight: 4,
            opacity: 0.7
        }).addTo(map);
    }

    function initStations() {
        var fromSelect = document.getElementById('fromStation');
        var toSelect = document.getElementById('toStation');
        
        // Copy options from fromStation to toStation
        toSelect.innerHTML = fromSelect.innerHTML;
    }

    function calculateDistance(from, to) {
        var fromCoords = stations[from];
        var toCoords = stations[to];
        
        // Calculate number of stations between
        var stationNames = Object.keys(stations);
        var fromIndex = stationNames.indexOf(from);
        var toIndex = stationNames.indexOf(to);
        return Math.abs(toIndex - fromIndex);
    }

    function updatePrice() {
        var fromStation = document.getElementById('fromStation').value;
        var toStation = document.getElementById('toStation').value;
        var discountType = document.getElementById('discountType').value;
        var passengers = parseInt(document.getElementById('passengerCount').textContent);

        // Return if stations not selected
        (fromStation === '' || toStation === '') && (document.querySelector('.train-list').innerHTML = '');

        var distance = calculateDistance(fromStation, toStation);
        var rawPrice = basePrice + (distance * pricePerStation);
        var discount = discountRates[discountType];
        var finalPrice = rawPrice * (1 - discount) * passengers;

        // Update train options display
        updateTrainOptions(finalPrice);
    }

    function updateTrainOptions(basePrice) {
        var trainList = document.querySelector('.train-list');
        trainList.innerHTML = `
            <div class="card shadow-sm mb-3 train-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">Express Train</h5>
                            <p class="card-text text-muted mb-2">Faster Travel Time</p>
                            <div class="d-flex gap-2">
                                <span class="badge bg-light text-dark">Premium Service</span>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="price-badge mb-2">₱${Math.round(basePrice * 1.2)}</div>
                            <button class="btn btn-primary" onclick="bookTicket('express')">Book Now</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card shadow-sm mb-3 train-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">Regular Train</h5>
                            <p class="card-text text-muted mb-2">Standard Service</p>
                            <div class="d-flex gap-2">
                                <span class="badge bg-light text-dark">Regular Service</span>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="price-badge mb-2">₱${Math.round(basePrice)}</div>
                            <button class="btn btn-primary" onclick="bookTicket('regular')">Book Now</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    function adjustPassengers(change) {
        var countElement = document.getElementById('passengerCount');
        var currentCount = parseInt(countElement.textContent);
        var newCount = currentCount + change;
        
        // Ensure count stays between 1 and 10
        newCount = Math.max(1, Math.min(10, newCount));
        countElement.textContent = newCount;
        updatePrice();
    }

    function bookTicket(trainType) {
        // Check if user is logged in
        (!currentUser) && (showNotification('Please sign in to book tickets'), 
            new bootstrap.Modal(document.getElementById('loginModal')).show(),
            return);

        var fromStation = document.getElementById('fromStation').value;
        var toStation = document.getElementById('toStation').value;
        var discountType = document.getElementById('discountType').value;
        var travelDate = document.getElementById('travelDate').value;
        var passengers = document.getElementById('passengerCount').textContent;

        // Validate selections
        (!fromStation || !toStation) && (showNotification('Please select both stations'), return);
        (!travelDate) && (showNotification('Please select a travel date'), return);

        // Create ticket object
        var ticket = {
            id: Date.now(),
            trainType: trainType,
            from: fromStation,
            to: toStation,
            discountType: discountType,
            date: travelDate,
            passengers: passengers,
            price: document.querySelector(`.train-card:${trainType === 'express' ? 'first' : 'last'}-child .price-badge`).textContent,
            status: 'Active'
        };

        // Save to history
        saveTicketToHistory(ticket);
        showNotification('Ticket booked successfully!');
        generateTicket(ticket);
    }

    function saveTicketToHistory(ticket) {
        ticketHistory.push(ticket);
        localStorage.setItem(`tickets_${currentUser.email}`, JSON.stringify(ticketHistory));
        updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
        var historyContainer = document.getElementById('ticketHistory');
        historyContainer.innerHTML = ticketHistory.map(ticket => `
            <div class="card mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <h6 class="card-title">${ticket.from} → ${ticket.to}</h6>
                        <span class="badge bg-success">${ticket.status}</span>
                    </div>
                    <p class="card-text">
                        <small class="text-muted">
                            ${ticket.date} • ${ticket.trainType} Train • ${ticket.passengers} Passenger(s)
                        </small>
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="price-badge">${ticket.price}</span>
                        <button class="btn btn-sm btn-outline-primary" onclick="generateTicket(${JSON.stringify(ticket)})">
                            View Ticket
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function showNotification(message, type = 'info') {
        var notification = document.createElement('div');
        notification.className = `custom-notification alert alert-${type}`;
        notification.innerHTML = message;
        document.querySelector('.notification-container').appendChild(notification);
        
        // Show notification
        notification.style.display = 'block';
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    function login() {
        var email = document.getElementById('loginEmail').value;
        var password = document.getElementById('loginPassword').value;
        
        currentUser = { email: email };
        document.getElementById('userDisplay').textContent = email;
        
        // Load user's ticket history
        ticketHistory = JSON.parse(localStorage.getItem(`tickets_${email}`) || '[]');
        updateHistoryDisplay();
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
        showNotification('Logged in successfully!', 'success');
    }

    function generateTicket(ticket) {
        // Create a printable ticket view
        var ticketHTML = `
            <div class="modal fade" id="ticketModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Your Ticket</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="ticket-container border rounded p-4">
                                <div class="text-center mb-4">
                                    <h4>MRT Booking System</h4>
                                    <small class="text-muted">E-Ticket</small>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-6">
                                        <strong>From:</strong> ${ticket.from}
                                    </div>
                                    <div class="col-6">
                                        <strong>To:</strong> ${ticket.to}
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-6">
                                        <strong>Date:</strong> ${ticket.date}
                                    </div>
                                    <div class="col-6">
                                        <strong>Train:</strong> ${ticket.trainType}
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-6">
                                        <strong>Passengers:</strong> ${ticket.passengers}
                                    </div>
                                    <div class="col-6">
                                        <strong>Price:</strong> ${ticket.price}
                                    </div>
                                </div>
                                <div class="text-center mt-4">
                                    <img src="https://via.placeholder.com/200x50?text=Barcode" alt="Barcode">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" onclick="window.print()">Print Ticket</button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Add modal to document and show it
        document.body.insertAdjacentHTML('beforeend', ticketHTML);
        var ticketModal = new bootstrap.Modal(document.getElementById('ticketModal'));
        ticketModal.show();
        
        // Remove modal from DOM after it's hidden
        document.getElementById('ticketModal').addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }
</script>
</body>
</html>
